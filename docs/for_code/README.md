# Документация по коду Исполнителей

_Документация актуальна на **2.12.2023**_

### Оглавление

1. [Структура кода](#структура-кода)
2. [Описание исполнителей](#описания-исполнителей)
3. [Особенности метод. стороны](#особенности-метод-стороны)
    - [Особенности составления задач](#особенности-составления-задач)
    - [Особенности составления решения задач в Excel-таблице](#особенности-составления-решения-задач-в-excel-таблице)
4. [Особенности ученической стороны](#особенности-ученической-стороны)
    - [Общие компоненты](#общие-компоненты)
        - [Компонент Task](#компонент-task)
        - [Компонент Commands](#компонент-commands)
        - [Компонент SolutionCont](#компонент-solutioncont)
    - [Компоненты визуализации Исполнителей](#компоненты-визуализации-исполнителей)
        - [Компонент DoublerDiveder](#компонент-doublerdiveder)
        - [Компонент Aquarius](#компонент-aquarius)
        - [Компонент Grasshopper](#компонент-grasshopper)
        - [Компонент Modal](#компонент-modal)
    - [Компонент App](#компонент-app)

##  СТРУКТУРА КОДА

- `assets` - папка с картинками
- `css` - папка с CSS-файлами
    - `fonts` - папка для шрифтов
    - `accordion.css` - файл стилей для страницы посмотра занятий
    - `editor.css` - файл стилей для страницы создания занятий
    - `index.css` - основной файл стилей для всех страниц. В нем также хранятся все используемые цвета.
- `db` - папка базы данных с уроками
    - `lessonN.json` - файлы с данными для уроков, где **`N`** - это номер урока.
    - `pass.json` - пароль для входа на метод. сторону Исполнителей
    - остальные файлы были добавлены методистами для их удобства
- `js` - папка с основным кодом Исполнителей. Код написан с использованием фреймворка Vue.js.
    - `index.js` - основной файл для рендеринга всего приложения
    - `App.js` - основной файл для рендеринга компонентов самих Исполнителей и хранения методов для их работы
    - `components` - папка с основными компонентами Исполнителей
        - `Header.js` - компонент для рендеринга шапки Исполнителей (логотип + название исполнителя или страницы для методиста)
        - `Task.js` - компонент для отображения условия задачи, а также отвечающий за переключение задач внутри одного шага
        - `taskVisual` - папка с компонентами для визуализации работы конкретных Исполнителей
            - `Aquarius.js` - визуализация работы исполнителя Водолей
            - `DoublerDivider.js` - визуализация работы исполнителей Удвоитель и Поделитель
            - `Grasshopper.js` - визуализация работы исполнителя Кузнечик
        - `Commands.js` - компонент отображения команд конкретного Исполнителя
        - `SolutionCont.js` - компонент отображения решения ученика
        - `Modal.js` - компонент, отвечающий за работу модального окна для создания процедур для исполнителя Кузнечик
    - `method_components` - папка с компонентами для работы методиста
        - `CreateLesson.js` - компонент, отвечающий за отображение и работу методов для создания занятия
        - `ShowLessons.js` - компонент, отвечающий за отображение списка созданных занятий, списка ссылок для каждой задачи внутри каждого занятия и возможностью скачать сгенерированную таблицу эталонных решений и кодов для преподавателя
    - `helpers` - папка с модулями "помощи" по различным направлениям
        - `commandHelper.js` - модуль с функциями для отображения и создания решений ("помощник" для компонентов команд и решений)
        - `excelHelper.js` - модуль с функциями для генерации Excel-файла
        - `makeAlgorithmHelper.js` - модуль с функциями для генерации алгоритма решения для каждого Исполнителя
- `index.html` - главный файл, откуда подключаются остальные компоненты и другие ресурсы

## ОПИСАНИЯ ИСПОЛНИТЕЛЕЙ

Параметры из `db`

### Общие параметры

- `level` - номер шага, тип данных - _число_.
- `tasks` - _список_ задач для этого шага, тип данных - _массив объектов_.
- `task` - номер задачи, тип данных - _число_.
- `executor` - кодовое название исполнителя, тип данных - _строка_.
- `task_title` - название задачи, тип данных - _строка_.
- `task_text` - условие задачи, тип данных - _массив строк_. Если в условии задачи несколько строк, то они пишутся через запятую.
- `params` - параметры исполнителя, которые используются в задаче, тип данных - _объект_. Объект для каждого исполнителя свой, описание наполнения этого объекта для каждого исполнителя см. ниже.
- `verif_code` - баллы за задачу и коды для проверки преподавателем, тип данных - _объект_. На данный момент используются 3 кода:

  - код `0` - если решение неверное, то есть не достигнута цель задачи.
  - код `75` - если решение верное, но не оптимальное, то есть ученик использовал больше команд, чем в эталонном решении.
  - код `100` - если решение верное и оптимальное, то есть использовалось столько же или меньше команд, чем в эталонном решении, для решения задачи.

  _Примечание._ Это сделано для большей простоты создания задач с ручной проверкой.
  
  Каждый код генерится автоматически по следующей схеме:
  - шестизначный рандомный код из заглавных английских букв
  - через тире балл ученика (0/75/100, описание выше)
  - указание кода задачи в следующем формате: `LnTm`, где `n` - номер текущего урока, `m` - порядковый номер задачи в уроке

_**Примечания.**_
1. _`Значения по умолчанию` ни для одного параметра не предусмотрены!_
2. _Проверка на соответствие типу данных не предусмотрена!_

Далее - описания _параметров_ для каждого исполнителя.

### Исполнитель Удвоитель

Тип данных для каждого из следующих параметров - _число_.

- Кодовое название - `doubler`. Пишется в параметре `executor`.
- `start` - начальное значение, с которого начинается решение. По умолчанию - это `0`.
- `end` - итоговое значение, к которому должно привести решение.
- `plus` - значение, которое можно будет прибавлять. По умолчанию - это `1`.
- `multi` - значение, на которое можно будет умножать. По умолчанию - это `2`.
- `steps` - эталонное количество команд, за которое можно решить задачу.

### Исполнитель Поделитель

Тип данных для каждого из следующих параметров - _число_.

- Кодовое название - `divider`. Пишется в параметре `executor`.
- `start` - начальное значение, с которого начинается решение.
- `end` - итоговое значение, к которому должно привести решение. По умолчанию - это `0`.
- `minus` - значение, которое можно будет отнимать. По умолчанию - это `1`.
- `divide` - значение, на которое можно будет делить. По умолчанию - это `2`.
- `steps` - эталонное количество команд, за которое можно решить задачу.

### Исполнитель Водолей

Тип данных для каждого, кроме одного, из следующих параметров - _число_.

- Кодовое название - `aquarius`. Пишется в параметре `executor`.
- `volumeA` - объем емкости А.
- `volumeB` - объем емкости В.
- `start_volumeA` - значение воды, налитое в начале задачи в емкость А. По умолчанию - это `0`.
- `start_volumeB` - значение воды, налитое в начале задачи в емкость В. По умолчанию - это `0`.
- `target` - массив значений воды, которые нужно набрать в одной из емкостей, тип данных - _массив чисел_.
- `steps` - эталонное количество команд, за которое можно решить задачу.

### Исполнитель Кузнечик

Тип данных для каждого, кроме одного, из следующих параметров - _число_.

- Кодовое название - `grasshopper`. Пишется в параметре `executor`.
- `forward` - значение, на которое исполнителю можно перемещаться вперед.
- `backward` - значение, на которое исполнителю можно перемещаться назад.
- `start` - начальное значение, с которого начинается решение. По умолчанию - это `0`.
- `target` - массив значений, которые нужно получить в последовательности решения, тип данных - _массив чисел_. ***Порядок чисел важен!***
- `steps` - эталонное количество команд, за которое можно решить задачу.
- `procedure` - возможность составлять и применять процедуры. При значении `0` возможность работать с процедурами _отключена_, при значении `1` - _включена_.

_**Примечание.** Приписка "по умолчанию" работает на стороне методиста. То есть при создании занятия по умолчанию вставляются эти значения._

## ОСОБЕННОСТИ МЕТОД. СТОРОНЫ

### Особенности составления задач

Задачи составляются методистом через компонент `CreateLesson`. В нем доступны следующие функции:

- Ввод номера урока через поле ввода
- `createLevel` - cоздать шаг 
- `createTask` - cоздать задачу
- `deleteItem` - удалить созданный элемент - шаг или задачу
- Наполнить задачу данными через поля ввода
- `changeTaskText` - создает список строк для корректного отображения задания
- `changeTaskTarget` - создает список целей для корректной работы проверки решений
- `changeCode` - задает значения по умолчанию в коде
- Вывод данных урока в виде кода формата json
- `saveFileJSON` - сохранение json-файла с данными урока

#### Генерация ссылки для задачи

1. Составляются параметры ссылки по шаблону `?lesson=N&level=M&task=K`, где **N** - это номер урока, **M** - номер шага, **K** - номер задания.
2. Параметры подставляются в итоговую ссылку. Итоговая ссылка на задачу будет выглядеть примерно так:

   `https://shpschool.github.io/algo5/?lesson=1&level=1&task=1`

_Примечания._
1. Ссылки генерятся в компоненте `ShowLessons` и могут быть автоматически скопированы (функция `copy`) методистом для подставления в методичку.
2. Ссылку отдельно на урок получить нельзя.

#### Зачем нужен шаг?

- Шаг нужен для того, чтобы можно было скрыть от учеников задачи, которые на данный момент им решать не нужно.
- Переключение между задачами идет исключительно в рамках шага.
- Для того чтобы перейти на новый шаг, ученикам нужно перейти по ссылке на задачу из другого шага. Так мы стараемся предотвратить решение задач наперед.

### Особенности составления решения задач в Excel-таблице

- Для составления самой Excel-таблицы используется библиотека `xlsx-js-style`, подключенная через CDN в компонент `ShowLessons`.
- Функция `downloadExcel` предоставляет возможность скачать Excel-таблицу при наличии введенного в нужное поле названия документа.
- В генерации этого документа участвуют также модули `excelHelper` и `makeAlgorithmHelper` из папки `helpers`.
- Формат оформления таблицы и алгоритмов решений внутри нее был согласован с методистом _Иваном Новаковичем_.
- Алгоритмы для составления решения задач исполнителей были составлены либо методистом, либо с его проверкой разработчиком.

## ОСОБЕННОСТИ УЧЕНИЧЕСКОЙ СТОРОНЫ

### Общие компоненты

#### Компонент `Task`

**Главная функция** - отображение условия задачи

Передаваемые от родителя параметры:
- `taskTitle` - название задачи
- `taskText` - непосредственно текст условия задачи. В нем может быть использован html-код
- `min`, `max` - номера первого и последнего заданий в шаге соответственно. Используются в функциях `prev`, `next`

Методы, реализованные в самом компоненте:
- `prev`, `next` - функции для переключения задач на одну назад и вперед соответственно через изменение URL-адреса страницы

#### Компонент `Commands`

**Главная функция** - отображение команд Исполнителя и их выполнение

Передаваемые от родителя параметры:
- `executor` - кодовое название исполнителя текущей задачи
- `args` - параметры конкретного исполнителя (некоторые параметры из объекта `params` из БД)
- `commands` - список команд, которые на данный момент используются в задаче (то есть список конкретных команд Исполнителя)
- `currentValue`, `currVolumeA`, `currVolumeB` - текущие значения при решении задачи. `currVolumeA`, `currVolumeB` используются для исполнителя Водолей, `currentValue` - для остальных Исполнителей
-  `volumeA`, `volumeB` - объем емкостей А и В соответсвенно. Используется для исполнителя Водолей
- `procedure` - показатель, можно ли использовать в задаче процедуры. Используется для исполнителя Кузнечик 
- `procedures` - список используемых процедур. Используется для исполнителя Кузнечик

Передаваемые от родителя функции:
- `addCommandToSolution` - функция добавления в список решения новой команды, которую использовал ученик в решении задачи. В ней также использованы вспомогательные функции из модуля  `commandHelper.js` из папки `helpers`
- `changeCurrentValue`, `changeVolumeA`, `changeVolumeB` - функция изменения соответствующего текущего значения
- `saveCommands` - функция сохранения списка команд для задачи (сохраняет передаваемый список команд в список `commands`)
- `openModal` - функция открытия модального окна для создания процедуры. Используется для исполнителя Кузнечик
- `removeProcedure` - функция удаления процедуры из списка команд. Используется для исполнителя Кузнечик. В ней также использованы вспомогательные функции из модуля  `commandHelper.js` из папки `helpers`

Методы, реализованные в самом компоненте:
- `makeCommands` - функция для составления списка команд в зависимости от текущего Исполнителя
- остальные методы - это функции выполненния команд Исполнителя. Работают по общему принципу: изменить текущее значение в задаче и добавить команду в список решения

#### Компонент `SolutionCont`

**Главная функция** - отображать решение, давать возможность изменять и проверять решение

Параметры и функции, передаваемые от родителя:
- `solution` - список команд в решении
- `verifCode` - объект проверочных кодов из БД
- `checkSolution` - функция проверки решения. При ее выполнении изменяются параметры `points`, `show`
- `points` - полученные учеником баллы за решение
- `show` - параметр, отвечающий за показ результатов решения
- `clean` - функция очистки решения
- `back` - функция для отмены последнего действия (последней добавленной в список решения команды)
- `repeat` - функция повторения последнего действия. Если была добавлена новая команда, то функция перестает быть доступной для использования
- `solutionLength` - длина решения ученика. Может отличаться от длины списка команд в решении, поэтому передается отдельно
- `renderSolution` - функция из модуля `commandHelper.js` из папки `helpers`. Ее описание можно посмотреть внутри модуля

### Компоненты визуализации Исполнителей

**Главная функция** каждого из приведенных ниже компонентов (кроме компонента `Modal`) - отображение действий ученика в рамках конкретного Исполнителя.

#### Компонент `DoublerDiveder`

Параметры, передаваемые от родителя:
- `start` - стартовая точка отчета для задачи
- `end` - итоговый результат, который должен быть получен
- `currentValue` - текущее значение выполнения команд Исполнителя

Эти параметры универсальны для двух исполнителей, поэтому компонент отображения у них один на двоих.

#### Компонент `Aquarius`

Параметры, передаваемые от родителя:

- `volumeA`, `volumeB` - объем емкостей А и В соответственно
- `currVolumeA`, `currVolumeB` - текущие значения жидкости внутри емкостей А и В соответственно
- `taskParams` - параметры задачи. Используется для проверки конечных целей задачи

Методы и переменные, реализованные внутри самого компонента:

- `doneA`, `doneB` - переменные, которые нужны для обозначения достижения цели задачи. Если целей несколько, то каждая цель будет обозначаться отдельно. При достижении цели меняется цвет "жидкости" в емкости. Изменение цвета реализовано через именение класса, а изменение переменных реализовано через механизм `watch`
- `styleA`, `styleB` - переменные, которые нужны для изменения размеров емкостей. Используются в методе `created` при создании компонента, изменяют стили блоков, отвечающих за отображение емкостей

#### Компонент `Grasshopper`

`currentValue` - параметр, передаваемый от родителя. Это текущее значение, на котором "стоит Кузнечик" в данный момент. Используется также в методах компонента

Переменные и методы самого компонента:

- `changeMinWidth` - вычисляемое свойство для минимальной ширины отображения блоков чисел на числовой прямой
- `numbersPrev` - список чисел, отображаемых до текущего значения
- `numbersNext` - список чисел, отображаемый после текущего значения
- `setNumbers` - метод для отображения числовой прямой. Использует списки `numbersPrev` и `numbersNext` для добавления в них чисел до текущего значения и после него. В списки добавляется по 30 чисел для достаточного отображения числовой прямой как на маленьких, так и на больших экранах

#### Компонент `Modal`

Данный компонент - это модальное окно. Его **главная функция** - создание процедуры для исполнителя Кузнечик.

Данный компонент содержит в себе видоизмененные компоненты `Commands` и `SoutionCont`, поэтому часть функций компонента будет описана кратко и будут приведены отсылки к тем компонентам, где есть более подробное описание.

Параметры и методы, передаваемые от родителя:

- `isActive` - переменная состояния, указывающая на то, активно ли сейчас модальное окно
- `commands` - список доступных команд. Тот же список, что и в [компоненте `Commands`](#компонент-commands)
- `procedures` - список используемых процедур. Тот же список, что и в [компоненте `Commands`](#компонент-commands)
- `args` - параметры задачи, используются в определении используемых команд
- `currentValue` - текущее значение на числовой прямой. Используется для создания функции ученической процедуры
- `changeCurrentValue`, `addCommandToSolution` - методы для сохранения текущего значения и использованной команды. Это методы, используемые при создании функции ученической процедуры, описаны подробнее в [компоненте `Commands`](#компонент-commands)
- `ch` - модуль, содержащий функции `renderSolution` и `changeSolLen`, используемые в этом компоненте. Описания функций есть в модуле `commandHelper.js` из папки `helpers`.
- `closeModal` - функция закрытия модального окна. Изменяет переменную `isActive`. Является той же функцией, что и `openModal` в [компоненте `Commands`](#компонент-commands)
- `addProcedure` - функция добавления процедуры в список `procedures`, а также добавления отображения процедуры внутри контейнера решения. Внутри функции используются  другие функции, вынесенные в модуль `commandHelper.js` из папки `helpers`.

Переменные самого компонента:

- `procedureName` - переменная для хранения названия процедуры
- `canClose` - переменная состояния, указывающая на возможность закрытия модального окна
- `modalCommands` - список команд, которые можно использовать внутри модального окна
- `modalSolution` - список для хранения команд, используемых в создаваемой процедуре
- `modalDeleteArr` - список для хранения отмененных команд
- `modalCurrentValue` - значение, получаемое после использования команд при создании процедуры. В итоге будет являться значением, которое будет изменять текущее значение всей задачи (значением процедуры)
- `modalSolutionLength` - количество команд, использованных при создании процедуры
- `afterChange` - переменная состояния, указывающая на то, изменялось ли название процедуры или еще нет

Watchers-ы этого компонента:

- `isActive` - при открытии модального окна происходит запись в списки команд и процедур доступных команд для использования при создании новой процедуры
- `procedureName` - при изменении названия процедуры меняется состояние `afterChange`

Методы самого компонента:

- `closeAndCleanModal` - функция закрытия модального окна и очищения внутренних переменных
- `checkClose` - проверка того, где произошло событие нажатия. Изменяет состояние `canClose`
- `canCloseModal` - проверка того, можно ли закрыть модальное окно
- `forward`, `backward` - функции выполнения базовых команд исполнителя Кузнечик
- `clean`, `back`, `repeat` - функции изменения решения внутри модального окна. Принцип работы такой же, как и функций из [компонента `SolutionCont`](#компонент-solutioncont)
- `addCommandToModalSolution` - функция добавления команды в решение для процедуры
- `makeProcedure` - создание процедуры как команды Исполнителя

### Компонент `App`

**Главная функция** - отображение и поддержание работы текущей задачи. Является родительским компонентом ученической стороны Исполнителей

Здесь будут описаны только методы, реализованные в компоненте и которые еще не были описаны. Описание переменных или дополнительных функций, вынесенных в отдельные модули, можно посмотреть в описаниях других компонентов или внутри самих модулей.

Методы, реализованные в компоненте:
- `modalActive` - переключает состояние модального окна (открыто/закрыто). Передается как функции `openModal` и `closeModal` в другие компоненты
- `removeProcedureFromProcedures` - функция удаления процедуры из html-элементов и списка процедур. Используется как вспомогательная функция для функции `removeProcedure`
- `pushValue` - функция добавления целевого значения в список `receivedValues`
- `isTarget` - функция для проверки значения, является ли оно тем, которое нужно получить по условию задачи
- `popValue` - функция удаления целевого значения из списка `receivedValues`
- `checkAquaTargets`, `checkHopperTargets` - функции проверки достижения целей задачи для исполнителей Водолея и Кузнечика соответственно
- `changeRender` - функция проверки текущего размера окна для изменения отображения Исполнителей
- `created` - функция, вызываемая при создании компонента. В ней происходит получение данных из БД по URL-адресу страницы, а далее идет наполнение данными внутренних переменных, которые передаются в другие компоненты
